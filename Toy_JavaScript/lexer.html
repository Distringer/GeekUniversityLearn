<script>
    class XRegExp {
        constructor(source, flag, root='root') {
            this.table = new Map();
            this.regexp = new RegExp(this.compileRegExp(source, root, 0), flag);
        }

        compileRegExp(source, name, start) {
            if(source[name] instanceof RegExp) return {
                source: source[name].source,
                length: 0
            };
            
            let length = 0;
            let regexp = source[name].repalce(/\<([^>]+)\>/g, (str, $1) => {
                this.table.set(start, $1);
                this.table.set($1, start);
                ++length;

                let r = compileRegExp(source, $1);

                length += r.length;
                return "(" + r.source + ")";
            });
            return {
                source: regexp,
                length: length
            }; 
        }

        exec(string) {
            let r = this.regexp.exec(string);
            for(let i=1; i<r.length; i++){
                if(r[i] !== void 0) {
                    console.log(this.table.get(i-1));
                }
            }
            return r[0];
        }
        get lastIndex(){
            return this.regexp.lastIndex;
        }
        set lastIndex(value){
            return this.regexp.lastIndex = value;
        }
    }

    function compileRegExp(xregexp, name) {
        if(xregexp[name] instanceof RegExp) return xregexp[name].source;
        let regexp = xregexp[name].source.repalce(/\<([^>]+)\>/, function(str, $1) {
            return compileRegExp(xregexp, $1);
        });
        return regexp; 
    }

    function scan(str) {
        let regexp = new RegExp( compileRegExp({
            InputElement: "<Whitespace>|<LineTerminator>|<Comments>|<Token>",
            Whitespace: / /,
            LineTerminator: /\n/,
            Comments: /\*(?:[^*]|\*[^\/])*\*\/|\/\/[^\n]*/,
            Token: "<Literal>|<Keywords>|<Identifer>|<Punctuator>",
            Literal:  "<NumbericLiteral>|<BooleanLiteral>|<StringLiteral>|<NullLiteral>",
            NumbericLiteral: /(?:[1-9][0-9]*|0)\.[0-9]*/,
            BooleanLiteral: /true|false/,
            StringLiteral: /\"(?:[^"\n]|\\[\s\S])*\"|\'(?:[^'\n]|\\[\s\S])*\'/,
            NullLiteral: /null/,
            Identifer: /[a-zA-Z_$][a-zA-Z0-9_$]*/,
            Keywords: /if|else|for|function|let/,
            Punctuator: /\+|\,|\?|\{|\}\(|\=|\<|\+\+|==|=>|\*|\.)|\[|\]|;/
        },"InputElement") ,'g');
        while(regexp.lastIndex < str.length && regexp.lastIndex !== -1) {
            let r = regexp.exec(str);
            if(!r[0].length) break;
        }
    }

    scan(`
        let checkedFileName = '';
        for (const index in this.suitFileList) {
            const sf = this.suitFileList[index];
            if (!sf.checked) continue;
        }
    `)

</script>